<?xml version="1.0" encoding="UTF-8"?>
<chapter xml:id="ch20-inference-two-independent-means" xmlns:xi="http://www.w3.org/2001/XInclude">

<title>Inference for comparing two independent means</title>



<introduction>
  <p>We now extend the methods from <xref ref="ch19-inference-single-mean"/> to apply confidence intervals and hypothesis tests to differences in population means that come from two groups, Group 1 and Group 2: <m>\mu_1 - \mu_2.</m>
In our investigations, we'll identify a reasonable point estimate of <m>\mu_1 - \mu_2</m> based on the sample, and you may have already guessed its form: <m>\bar{x}_1 - \bar{x}_2.</m> <idx><h>point estimate</h><h>difference in means</h></idx><idx><h>difference in means</h><h>point estimate</h></idx> Then we'll look at the inferential analysis in three different ways: using a randomization test, applying bootstrapping for interval estimates, and, if we verify that the point estimate can be modeled using a normal distribution, we compute the estimate's standard error and apply the mathematical framework.</p>

  <p>In this section we consider a difference in two population means, <m>\mu_1 - \mu_2,</m> under the condition that the data are not paired. Just as with a single sample, we identify conditions to ensure we can use the <m>t</m>-distribution with a point estimate of the difference, <m>\bar{x}_1 - \bar{x}_2,</m> and a new standard error formula.
The details for working through inferential problems in the two independent means setting are strikingly similar to those applied to the two independent proportions setting. We first cover a randomization test where the observations are shuffled under the assumption that the null hypothesis is true. Then we bootstrap the data (with no imposed null hypothesis) to create a confidence interval for the true difference in population means, <m>\mu_1 - \mu_2.</m> The mathematical model, here the <m>t</m>-distribution, is able to describe both the randomization test and the bootstrapping as long as the conditions are met.
The inferential tools are applied to three different data contexts: determining whether stem cells can improve heart function, exploring the relationship between pregnant women's smoking habits and birth weights of newborns, and exploring whether there is convincing evidence that one variation of an exam is harder than another variation. This section is motivated by questions like "Is there convincing evidence that newborns from mothers who smoke have a different average birth weight than newborns from mothers who do not smoke?"</p>

</introduction>

<section xml:id="sec-rand2mean">
  <title>Randomization test for the difference in means</title>


  <p>An instructor decided to run two slight variations of the same exam. Prior to passing out the exams, they shuffled the exams together to ensure each student received a random version. Anticipating complaints from students who took Version B, they would like to evaluate whether the difference observed in the groups is so large that it provides convincing evidence that Version B was more difficult (on average) than Version A.</p>


<note>
  <title>Data</title>
  <p>The <url href="http://openintrostat.github.io/openintro/reference/classdata.html"><c>classdata</c></url> data can be found in the <url href="http://openintrostat.github.io/openintro"><alert>openintro</alert></url> R package.</p>
</note>



<subsection>
  <title>Observed data</title>


  <p>Summary statistics for how students performed on these two exams are shown in <xref ref="tbl-summaryStatsForTwoVersionsOfExams"/> and plotted in <xref ref="fig-boxplotTwoVersionsOfExams"/>.</p>


<listing xml:id="tbl-summaryStatsForTwoVersionsOfExams">
  <caption>Summary statistics of scores for each exam version.</caption>
  <program language="r">
    <code>
classdata &lt;- classdata |&gt;
  filter(lecture %in% c("a", "b")) |&gt;
  mutate(
    lecture = str_to_upper(lecture),
    exam = lecture
  )

classdata |&gt;
  group_by(exam) |&gt;
  summarise(
    n = n(),
    mean = mean(m1),
    sd = sd(m1),
    min = min(m1),
    max = max(m1)
  ) |&gt;
  kbl(
    linesep = "", booktabs = TRUE,
    col.names = c("Group", "n", "Mean", "SD", "Min", "Max"),
    align = "ccccc"
  ) |&gt;
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"), full_width = FALSE
  ) |&gt;
  column_spec(1:5, width = "5em")
    </code>
  </program>
</listing>

<table>
  <title>Summary statistics of scores for each exam version.</title>
  <tabular>
    <row bottom="minor"><cell>Group</cell><cell>n</cell><cell>Mean</cell><cell>SD</cell><cell>Min</cell><cell>Max</cell></row>
    <row><cell>A</cell><cell>58</cell><cell>75.1</cell><cell>13.9</cell><cell>44</cell><cell>100</cell></row>
    <row><cell>B</cell><cell>55</cell><cell>72.0</cell><cell>13.8</cell><cell>38</cell><cell>100</cell></row>
  </tabular>
</table>


<listing xml:id="code-boxplotTwoVersionsOfExams">
  <caption>Exam scores for students given one of two different exams.</caption>
  <program language="r">
    <code>
ggplot(classdata, aes(x = exam, y = m1, color = exam)) +
  geom_boxplot(show.legend = FALSE) +
  geom_jitter(width = 0.1) +
  labs(title = "Box plot of exam score broken down by version of exam", x = "Exam", y = "Score") +
  scale_color_manual(values = c(IMSCOL["blue", "full"], IMSCOL["red", "full"]))
    </code>
  </program>
</listing>

<figure xml:id="fig-boxplotTwoVersionsOfExams">
  <caption>Exam scores for students given one of two different exams.</caption>
  <image source="images/fig-boxplotTwoVersionsOfExams-1.png" width="70%" />
</figure>


<exercise>
  <statement>
    <p>Construct hypotheses to evaluate whether the observed difference in sample means, <m>\bar{x}_A - \bar{x}_B=3.1,</m> is likely to have happened due to chance, if the null hypothesis is true. We will later evaluate these hypotheses using <m>\alpha = 0.01.</m></p>
  </statement>
  <solution>
    <p><m>H_0:</m> the exams are equally difficult, on average.     <m>\mu_A - \mu_B = 0.</m> <m>H_A:</m> one exam was more difficult than the other, on average.     <m>\mu_A - \mu_B \neq 0.</m></p>
  </solution>
</exercise>


<exercise>
  <statement>
    <p>Before moving on to evaluate the hypotheses in the previous Guided Practice, let's think carefully about the dataset. Are the observations across the two groups independent? Are there any concerns about outliers?</p>
  </statement>
  <solution>
    <p>Since the exams were shuffled, the "treatment" in this case was randomly assigned, so independence within and between groups is satisfied.     The summary statistics suggest the data are roughly symmetric about the mean, and the min/max values do not suggest any outliers of concern.</p>
  </solution>
</exercise>



</subsection>

<subsection>
  <title>Variability of the statistic</title>


  <p>In <xref ref="ch11-hypothesis-testing-randomization"/>, the variability of the statistic (previously: <m>\hat{p}_1 - \hat{p}_2)</m> was visualized after shuffling the observations across the two treatment groups many times. The shuffling process implements the null hypothesis model (that there is no effect of the treatment). In the exam example, the null hypothesis is that exam A and exam B are equally difficult, so the average scores across the two tests should be the same. If the exams were equally difficult, <em>due to natural variability</em>, we would sometimes expect students to do slightly better on exam A <m>(\bar{x}_A > \bar{x}_B)</m> and sometimes expect students to do slightly better on exam B <m>(\bar{x}_B > \bar{x}_A).</m> The question at hand is: does <m>\bar{x}_A - \bar{x}_B=3.1</m> indicate that exam A is easier than exam B.</p>


  <p><xref ref="fig-rand2means"/> shows the process of randomizing the exam to the observed exam scores. If the null hypothesis is true, then the score on each exam should represent the true student ability on that material. It shouldn't matter whether they were given exam A or exam B. By reallocating which student got which exam, we are able to understand how the difference in average exam scores changes due only to natural variability. There is only one iteration of the randomization process in <xref ref="fig-rand2means"/>, leading to one simulated difference in average scores.</p>


<listing xml:id="code-rand2means">
  <caption>| The version of the test (A or B) is randomly allocated to the test scores, under the null assumption that the tests are equally difficult.</caption>
  <program language="r">
    <code>
include_graphics("images/rand2means.png")
    </code>
  </program>
</listing>

<figure xml:id="fig-rand2means">
  <caption>The version of the test (A or B) is randomly allocated to the test scores, under the null assumption that the tests are equally difficult.</caption>
  <image source="images/rand2means.png" width="70%" />
</figure>


  <p>Building on <xref ref="fig-rand2means"/>, <xref ref="fig-randexams"/> shows the values of the simulated statistics <m>\bar{x}_{1, sim} - \bar{x}_{2, sim}</m> over 1,000 random simulations. We see that, just by chance, the difference in scores can range anywhere from -10 points to +10 points.</p>


<listing xml:id="code-randexams">
  <caption>| Histogram of differences in means, calculated from 1,000 different randomizations of the exam types.</caption>
  <program language="r">
    <code>
set.seed(47)
classdata |&gt;
  specify(m1 ~ exam) |&gt;
  hypothesize(null = "independence") |&gt;
  generate(reps = 1000, type = "permute") |&gt;
  calculate(stat = "diff in means", order = c("A", "B")) |&gt;
  visualize() +
  labs(
    title = "1,000 differences in randomized means",
    x = "Difference in randomized means\n(A - B)",
    y = "Count"
  )
    </code>
  </program>
</listing>

<figure xml:id="fig-randexams">
  <caption>Histogram of differences in means, calculated from 1,000 different randomizations of the exam types.</caption>
  <image source="images/fig-randexams-1.png" width="70%" />
</figure>


</subsection>

<subsection>
  <title>Observed statistic vs. null statistics</title>


  <p>The goal of the randomization test is to assess the observed data, here the statistic of interest is <m>\bar{x}_A - \bar{x}_B=3.1.</m> The randomization distribution allows us to identify whether a difference of 3.1 points is more than one would expect by natural variability of the scores if the two tests were equally difficult. By plotting the value of 3.1 on <xref ref="fig-randexamspval"/>, we can measure how different or similar 3.1 is to the randomized differences which were generated under the null hypothesis.</p>


<listing xml:id="code-randexamspval">
  <caption>| Histogram of differences in means, calculated from 1,000 different randomizations of the exam types. The observed difference of 3.1 points is plotted as a vertical line, and the area more extreme than 3.1 is shaded to represent the p-value.</caption>
  <program language="r">
    <code>
stat_2means &lt;- classdata |&gt;
  specify(m1 ~ exam) |&gt;
  calculate(stat = "diff in means", order = c("A", "B"))

set.seed(47)
classdata |&gt;
  specify(m1 ~ exam) |&gt;
  hypothesize(null = "independence") |&gt;
  generate(reps = 1000, type = "permute") |&gt;
  calculate(stat = "diff in means", order = c("A", "B")) |&gt;
  visualize() +
  labs(
    title = "1,000 differences in randomized means",
    x = "Difference in randomized means\n(A - B)",
    y = "Count"
  ) +
  shade_p_value(obs_stat = stat_2means, direction = "two-sided", color = IMSCOL["red", "full"])
    </code>
  </program>
</listing>

<figure xml:id="fig-randexamspval">
  <caption>Histogram of differences in means, calculated from 1,000 different randomizations of the exam types. The observed difference of 3.1 points is plotted as a vertical line, and the area more extreme than 3.1 is shaded to represent the p-value.</caption>
  <image source="images/fig-randexamspval-1.png" width="70%" />
</figure>


<example>
  <statement>
    <p>Approximate the p-value depicted in <xref ref="fig-randexamspval"/>, and provide a conclusion in the context of the case study.</p>
  </statement>
  <solution>
    <p>Using software, we can find the number of shuffled differences in means that are less than the observed difference (of 3.14) is 900 (out of 1,000 randomizations). So 10% of the simulations are larger than the observed difference. To get the p-value, we double the proportion of randomized differences which are larger than the observed difference, p-value = 0.2.</p>
    <p>Previously, we specified that we would use <m>\alpha = 0.01.</m> Since the p-value is larger than <m>\alpha,</m> we do not reject the null hypothesis. That is, the data do not convincingly show that one exam version is more difficult than the other, and the teacher should not be convinced that they should add points to the Version B exam scores.</p>
  </solution>
</example>


  <p>The large p-value and consistency of <m>\bar{x}_A - \bar{x}_B=3.1</m> with the randomized differences leads us to <em>not reject the null hypothesis</em>. Said differently, there is no evidence to think that one of the tests is easier than the other. One might be inclined to conclude that the tests have the same level of difficulty, but that conclusion would be wrong. The hypothesis testing framework is set up only to reject a null claim, it is not set up to validate a null claim. As we concluded, the data are consistent with exams A and B being equally difficult, but the data are also consistent with exam A being 3.1 points "easier" than exam B. The data are not able to adjudicate on whether the exams are equally hard or whether one of them is slightly easier. Indeed, conclusions where the null hypothesis is not rejected often seem unsatisfactory. However, in this case, the teacher and class are probably all relieved that there is no evidence to demonstrate that one of the exams is more difficult than the other.</p>


</subsection>

</section>

<section>
  <title>Bootstrap confidence interval for the difference in means</title>


  <p><idx>difference in means</idx></p>


  <p>Before providing a full example working through a bootstrap analysis on actual data, we return to the fictional Awesome Auto example as a way to visualize the two sample bootstrap setting. Consider an expanded scenario where the research question centers on comparing the average price of a car at one Awesome Auto franchise (Group 1) to the average price of a car at a different Awesome Auto franchise (Group 2). The process of bootstrapping can be applied to <em>each</em> Group separately, and the differences of means recalculated each time. <xref ref="fig-bootmeans2means"/> visually describes the bootstrap process when interest is in a statistic computed on two separate samples. The analysis proceeds as in the one sample case, but now the (single) statistic of interest is the <em>difference in sample means</em>. That is, a bootstrap resample is done on each of the groups separately, but the results are combined to have a single bootstrapped difference in means. Repetition will produce <m>k</m> bootstrapped differences in means, and the histogram will describe the natural sampling variability associated with the difference in means.</p>



<listing xml:id="code-bootmeans2means">
  <caption>| For the two group comparison, the bootstrap resampling is done separately on each group, but the statistic is calculated as a difference. The set of k differences is then analyzed as the statistic of interest with conclusions drawn on the parameter of interest.</caption>
  <program language="r">
    <code>
include_graphics("images/bootmeans2means.png")
    </code>
  </program>
</listing>

<figure xml:id="fig-bootmeans2means">
  <caption>For the two group comparison, the bootstrap resampling is done separately on each group, but the statistic is calculated as a difference. The set of k differences is then analyzed as the statistic of interest with conclusions drawn on the parameter of interest.</caption>
  <image source="images/bootmeans2means.png" width="70%" />
</figure>


  <p>In the following sections, we leave the fictional setting of Awesome Auto and apply the bootstrap method to actual datasets investigating whether embryonic stem cells help improve heart function and later to investigate characteristics of births. Note that the fictional setting allowed us to visualize the bootstrap method because we had samples of size five. The visualization was important in understanding how the bootstrap method works. However, the bootstrap relies heavily on the sample being an outstanding proxy for the population, and five observations are almost never enough to truly represent the nuances of a full population. To that end, we apply bootstrap methods with much larger sample sizes, as seen in the 1000 random samples provided in the births data.</p>


<subsection>
  <title>Observed data</title>


  <p>Does treatment using embryonic stem cells (ESCs) help improve heart function following a heart attack? <xref ref="tbl-statsSheepEscStudy"/> contains summary statistics for an experiment to test ESCs in sheep that had a heart attack. Each of these sheep was randomly assigned to the ESC or control group, and the change in their hearts' pumping capacity was measured in the study. [@Menard:2005] <xref ref="fig-stem-cell-histograms"/> provides histograms of the two datasets. A positive value corresponds to increased pumping capacity, which generally suggests a stronger recovery. Our goal will be to identify a 95% confidence interval for the effect of ESCs on the change in heart pumping capacity relative to the control group.</p>


<note>
  <title>Data</title>
  <p>The <url href="http://openintrostat.github.io/openintro/reference/stem_cell.html"><c>stem_cell</c></url> data can be found in the <url href="http://openintrostat.github.io/openintro"><alert>openintro</alert></url> R package.</p>
</note>


<listing xml:id="tbl-statsSheepEscStudy">
  <caption>Summary statistics of the embryonic stem cell study.</caption>
  <program language="r">
    <code>
stem_cell &lt;- openintro::stem_cell |&gt;
  mutate(
    trmt = if_else(trmt == "ctrl", "Control", "ESC"),
    trmt = fct_relevel(trmt, "ESC", "Control"),
    change = after - before
  )

stem_cell |&gt;
  group_by(trmt) |&gt;
  summarise(
    n = n(),
    mean = mean(change),
    sd = sd(change)
  ) |&gt;
  kbl(
    linesep = "", booktabs = TRUE,
    col.names = c("Group", "n", "Mean", "SD"),
    digits = 2, align = "lccc"
  ) |&gt;
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"), full_width = FALSE
  ) |&gt;
  column_spec(1:4, width = "6em")
    </code>
  </program>
</listing>

<table>
  <title>Summary statistics of the embryonic stem cell study.</title>
  <tabular>
    <row bottom="minor"><cell>Group</cell><cell>n</cell><cell>Mean</cell><cell>SD</cell></row>
    <row><cell>ESC</cell><cell>9</cell><cell>3.50</cell><cell>5.17</cell></row>
    <row><cell>control</cell><cell>9</cell><cell>-4.33</cell><cell>2.76</cell></row>
  </tabular>
</table>


  <p>The point estimate of the difference in the heart pumping variable is straightforward to find: it is the difference in the sample means.</p>


  <p><me>\bar{x}_{esc} - \bar{x}_{control}\   =\ 3.50 - (-4.33)\   =\ 7.83</me></p>


</subsection>

<subsection>
  <title>Variability of the statistic</title>


  <p>As we saw in <xref ref="sec-two-prop-boot-ci"/>, we will use bootstrapping to estimate the variability associated with the difference in sample means when taking repeated samples. In a method akin to two proportions, a <em>separate</em> sample is taken with replacement from each group (here ESCs and control), the sample means are calculated, and their difference is taken. The entire process is repeated multiple times to produce a bootstrap distribution of the difference in sample means (<em>without</em> the null hypothesis assumption).</p>


  <p><xref ref="fig-bootexamsci"/> displays the variability of the differences in means with the 90% percentile and SE confidence intevals super imposed.</p>


<listing xml:id="code-bootexamsci">
  <caption>| Histogram of differences in means after 1,000 bootstrap samples from each of the two groups. The observed difference is plotted as a black vertical line at 7.83. The blue dashed and red dotted lines provide the bootstrap percentile and bootstrap SE confidence intervals, respectively, for the difference in true population means.</caption>
  <program language="r">
    <code>
set.seed(470)

boot_2mean &lt;- stem_cell |&gt;
  specify(change ~ trmt) |&gt;
  generate(reps = 1000, type = "bootstrap") |&gt;
  calculate(stat = "diff in means", order = c("ESC", "Control"))

stat_2means &lt;- stem_cell |&gt;
  specify(change ~ trmt) |&gt;
  calculate(stat = "diff in means", order = c("ESC", "Control"))

ci_perc_2mean &lt;- boot_2mean |&gt;
  get_confidence_interval(level = 0.9, type = "percentile")

ci_se_2mean &lt;- boot_2mean |&gt;
  get_confidence_interval(
    level = 0.9, type = "se",
    point_estimate = stat_2means
  )

boot_2mean |&gt;
  infer::visualize() +
  infer::shade_confidence_interval(ci_perc_2mean, fill = NULL, size = 1, color = IMSCOL["green", "full"], linetype = "dashed") +
  infer::shade_confidence_interval(ci_se_2mean, fill = NULL, size = 1, color = IMSCOL["red", "full"], linetype = "dotted") +
  labs(
    title = "1,000 differences in bootstrapped means",
    x = "Differences in bootstrapped means\n(ESC - Control)",
    y = "Count"
  ) +
  geom_vline(xintercept = stat_2means$stat, size = 1) +
  expand_limits(x = c(0, 15), y = c(0, 200)) +
  geom_line(aes(y = 200, x = stat, color = "a", linetype = "a"), alpha = 0, size = 1) + # bogus code
  geom_line(aes(y = 200, x = stat, color = "b", linetype = "b"), alpha = 0, size = 1) + # bogus code
  geom_line(aes(y = 200, x = stat, color = "c", linetype = "c"), alpha = 0, size = 1) + # bogus code
  guides(color = guide_legend(override.aes = list(alpha = 1))) +
  scale_color_manual(
    name = NULL,
    values = c("a" = IMSCOL["blue", "full"], "b" = IMSCOL["red", "full"], "c" = IMSCOL["black", "full"]),
    labels = c("Percentile\ninterval\n", "SE\ninterval\n", "Observed\nstatistic"),
    guide = "legend"
  ) +
  scale_linetype_manual(
    name = NULL,
    values = c("a" = "dashed", "b" = "dotted", "c" = "solid"),
    labels = c("Percentile\ninterval\n", "SE\ninterval\n", "Observed\nstatistic"),
    guide = "legend"
  ) +
  theme(
    legend.position = c(0.87, 0.75),
    legend.background = element_rect(fill = "white")
  )
    </code>
  </program>
</listing>

<figure xml:id="fig-bootexamsci">
  <caption>Histogram of differences in means after 1,000 bootstrap samples from each of the two groups. The observed difference is plotted as a black vertical line at 7.83. The blue dashed and red dotted lines provide the bootstrap percentile and bootstrap SE confidence intervals, respectively, for the difference in true population means.</caption>
  <image source="images/fig-bootexamsci-1.png" width="70%" />
</figure>


<exercise>
  <statement>
    <p>Using the histogram of bootstrapped difference in means, estimate the standard error of the differences in sample means, <m>\bar{x}_{ESC} - \bar{x}_{Control}.</m></p>
  </statement>
  <solution>
    <p>The point estimate of the population difference (<m>\bar{x}_{ESC} - \bar{x}_{Control}</m>) is 7.83.</p>
  </solution>
</exercise>


<example>
  <statement>
    <p>Choose one of the bootstrap confidence intervals for the true difference in average pumping capacity, <m>\mu_{ESC} - \mu_{Control}.</m> Does the interval show that there is a difference across the two treatments?</p>
  </statement>
  <solution>
    <p>Because neither of the 90% intervals (either percentile or SE) above overlap zero (note that zero is never one of the bootstrapped differences so 95% and 99% intervals would have given the same conclusion!), we conclude that the ESC treatment is substantially better with respect to heart pumping capacity than the control.</p>
    <p>Because the study is a randomized controlled experiment, we can conclude that it is the treatment (ESC) which is causing the change in pumping capacity.</p>
  </solution>
</example>


</subsection>

</section>

<section xml:id="sec-math2samp">
  <title>Mathematical model for testing the difference in means</title>


  <p>Every year, the US releases to the public a large dataset containing information on births recorded in the country. This dataset has been of interest to medical researchers who are studying the relation between habits and practices of expectant mothers and the birth of their children. We will work with a random sample of 1,000 cases from the dataset released in 2014.</p>


<note>
  <title>Data</title>
  <p>The <url href="http://openintrostat.github.io/openintro/reference/births14.html"><c>births14</c></url> data can be found in the <url href="http://openintrostat.github.io/openintro"><alert>openintro</alert></url> R package.</p>
</note>


<subsection>
  <title>Observed data</title>


  <p>Four cases from this dataset are represented in <xref ref="tbl-babySmokeDF"/>. We are particularly interested in two variables: <c>weight</c> and <c>smoke</c>. The <c>weight</c> variable represents the weights of the newborns and the <c>smoke</c> variable describes which mothers smoked during pregnancy.</p>


<listing xml:id="tbl-babySmokeDF">
  <caption>Four cases from the <c>births14</c> dataset. The empty cells indicate missing data.</caption>
  <program language="r">
    <code>
births14 |&gt;
  select(-premie, -mature, -lowbirthweight, -whitemom, -marital) |&gt;
  head(4) |&gt;
  kbl(
    linesep = "", booktabs = TRUE,
    escape = FALSE, align = "cccclcclll"
  ) |&gt;
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped")
  )
    </code>
  </program>
</listing>

<table>
  <title>Four cases from the <c>births14</c> dataset. The empty cells indicate missing data.</title>
  <tabular>
    <row bottom="minor"><cell>fage</cell><cell>mage</cell><cell>weeks</cell><cell>visits</cell><cell>gained</cell><cell>weight</cell><cell>sexbaby</cell><cell>habit</cell></row>
    <row><cell>34</cell><cell>34</cell><cell>37</cell><cell>14</cell><cell>28</cell><cell>6.96</cell><cell>male</cell><cell>nonsmoker</cell></row>
    <row><cell>36</cell><cell>31</cell><cell>41</cell><cell>12</cell><cell>41</cell><cell>8.86</cell><cell>female</cell><cell>nonsmoker</cell></row>
    <row><cell>37</cell><cell>36</cell><cell>37</cell><cell>10</cell><cell>28</cell><cell>7.51</cell><cell>female</cell><cell>nonsmoker</cell></row>
    <row><cell>16</cell><cell>38</cell><cell></cell><cell></cell><cell>29</cell><cell>6.19</cell><cell>male</cell><cell>nonsmoker</cell></row>
  </tabular>
</table>


  <p>We would like to know, is there convincing evidence that newborns from mothers who smoke have a different average birth weight than newborns from mothers who do not smoke? We will use data from this sample to try to answer this question.</p>


<example>
  <statement>
    <p>Set up appropriate hypotheses to evaluate whether there is a relationship between a mother smoking and average birth weight.</p>
  </statement>
  <solution>
    <p>The null hypothesis represents the case of no difference between the groups.</p>
    <p>-   <m>H_0:</m> There is no difference in average birth weight for newborns from mothers who did and did not smoke. In statistical notation: <m>\mu_{n} - \mu_{s} = 0,</m> where <m>\mu_{n}</m> represents non-smoking mothers and <m>\mu_s</m> represents mothers who smoked. -   <m>H_A:</m> There is some difference in average newborn weights from mothers who did and did not smoke <m>(\mu_{n} - \mu_{s} \neq 0).</m></p>
  </solution>
</example>


  <p><xref ref="tbl-births14-summary-stats"/> displays sample statistics from the data. We can see that the average birth weight of babies born to smoker moms is lower than those born to nonsmoker moms.</p>


<listing xml:id="tbl-births14-summary-stats">
  <caption>Summary statistics for the <c>births14</c> dataset.</caption>
  <program language="r">
    <code>
births14_nona &lt;- births14 |&gt;
  filter(
    !is.na(habit), !is.na(weight)
  )

births14_sample_stats &lt;- births14_nona |&gt;
  group_by(habit) |&gt;
  summarise(
    n = n(),
    Mean = mean(weight),
    SD = sd(weight)
  )

xbar_nonsmoker &lt;- round(births14_sample_stats |&gt; filter(habit == "nonsmoker") |&gt; pull(Mean), 2)
xbar_smoker &lt;- round(births14_sample_stats |&gt; filter(habit == "smoker") |&gt; pull(Mean), 2)
xbar_difference &lt;- xbar_nonsmoker - xbar_smoker
sd_nonsmoker &lt;- round(births14_sample_stats |&gt; filter(habit == "nonsmoker") |&gt; pull(SD), 2)
sd_smoker &lt;- round(births14_sample_stats |&gt; filter(habit == "smoker") |&gt; pull(SD), 2)
n_nonsmoker &lt;- births14_sample_stats |&gt;
  filter(habit == "nonsmoker") |&gt;
  pull(n)
n_smoker &lt;- births14_sample_stats |&gt;
  filter(habit == "smoker") |&gt;
  pull(n)
se_difference &lt;- round(sqrt(sd_nonsmoker^2 / n_nonsmoker + sd_smoker^2 / n_smoker), 2)
t_difference &lt;- round(xbar_difference / se_difference, 2)
df_difference &lt;- min(n_nonsmoker - 1, n_smoker - 1)

births14_sample_stats |&gt;
  kbl(
    linesep = "", booktabs = TRUE,
    col.names = c("Habit", "n", "Mean", "SD"),
    align = "lccc", digits = 2
  ) |&gt;
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"), full_width = FALSE
  ) |&gt;
  column_spec(1:4, width = "7em")
    </code>
  </program>
</listing>

<table>
  <title>Summary statistics for the <c>births14</c> dataset.</title>
  <tabular>
    <row bottom="minor"><cell>Habit</cell><cell>n</cell><cell>Mean</cell><cell>SD</cell></row>
    <row><cell>nonsmoker</cell><cell>867</cell><cell>7.27</cell><cell>1.23</cell></row>
    <row><cell>smoker</cell><cell>114</cell><cell>6.68</cell><cell>1.60</cell></row>
  </tabular>
</table>


</subsection>

<subsection>
  <title>Variability of the statistic</title>


  <p>We check the two conditions necessary to model the difference in sample means using the <m>t</m>-distribution.</p>


  <ul>
    <li><p>Because the data come from a simple random sample, the observations are independent, both within and between samples.</p></li>
    <li><p>With both groups over 30 observations, we inspect the data in <xref ref="fig-babySmokePlotOfTwoGroupsToExamineSkew"/> for any particularly extreme outliers and find none.</p></li>
  </ul>


  <p>Since both conditions are satisfied, the difference in sample means may be modeled using a <m>t</m>-distribution.</p>


<listing xml:id="code-babySmokePlotOfTwoGroupsToExamineSkew">
  <caption>| The left panel represents birth weights for infants whose mothers smoked during pregnancy. The right panel represents the birth weights for infants whose mothers who did not smoke during pregnancy.</caption>
  <program language="r">
    <code>
births14_nona |&gt;
  mutate(habit = fct_rev(if_else(habit == "smoker", "Mothers who smoked", "Mothers who did not smoke"))) |&gt;
  ggplot(aes(x = weight)) +
  geom_histogram(binwidth = 1) +
  facet_wrap(~habit, ncol = 2, scales = "free_y") +
  scale_x_continuous(breaks = seq(0, 10, 2), limits = c(0, 10)) +
  labs(x = "Newborn weights (lbs)", y = "Count")
    </code>
  </program>
</listing>

<figure xml:id="fig-babySmokePlotOfTwoGroupsToExamineSkew">
  <caption>The left panel represents birth weights for infants whose mothers smoked during pregnancy. The right panel represents the birth weights for infants whose mothers who did not smoke during pregnancy.</caption>
  <image source="images/fig-babySmokePlotOfTwoGroupsToExamineSkew-1.png" width="70%" />
</figure>


<exercise>
  <statement>
    <p>The summary statistics in <xref ref="tbl-births14-summary-stats"/> may be useful for this Guided Practice. What is the point estimate of the population difference, <m>\mu_{n} - \mu_{s}</m>?</p>
  </statement>
  <solution>
    <p>The point estimate of the population difference (<m>\bar{x}_{n} - \bar{x}_{s}</m>) is <c>r xbar_difference</c>.</p>
  </solution>
</exercise>


</subsection>

<subsection>
  <title>Observed statistic vs. null statistics</title>


<assemblage>
  <p><alert>The test statistic for comparing two means is a T.</alert></p>
  <p><idx><h>T score</h><h>difference in means</h></idx><idx><h>difference in means</h><h>T score</h></idx></p>
  <p><idx>t-test</idx></p>
  <p>The T score is a ratio of how the groups differ as compared to how the observations within a group vary.</p>
  <p>\vspace{-5mm}</p>
  <p><me>T = \frac{(\bar{x}_1 - \bar{x}_2) - 0}{\sqrt{s_1^2/n_1 + s_2^2/n_2}}</me></p>
  <p>When the null hypothesis is true and the conditions are met, T has a t-distribution with <m>df = min(n_1 - 1, n_2 -1).</m></p>
  <p>Conditions:</p>
  <p>-   Independent observations within and between groups.</p>
  <p>-   Large samples and no extreme outliers.</p>
</assemblage>




<exercise>
  <statement>
    <p>Compute the standard error of the point estimate for the average difference between the weights of babies born to nonsmoker and smoker mothers.</p>
  </statement>
  <solution>
    <p><m>SE(\bar{x}_{n} - \bar{x}_{s}) = \sqrt{s^2_{n}/ n_{n} + s^2_{s}/n_{s}} = \sqrt{1.23^2/867 + 1.60^2/114} = 0.16</m></p>
  </solution>
</exercise>



<example>
  <statement>
    <p>Complete the hypothesis test started in the previous Example and Guided Practice on <c>births14</c> dataset and research question. Use a discernibility level of <m>\alpha=0.05.</m> For reference, <m>\bar{x}_{n} - \bar{x}_{s} = <c>r xbar_difference</c>,</m> <m>SE = <c>r se_difference</c>,</m> and the sample sizes were <m>n_n = <c>r n_nonsmoker</c></m> and <m>n_s = <c>r n_smoker</c>.</m></p>
  </statement>
  <solution>
    <p>We can find the test statistic for this test using the previous information:</p>
    <p>\vspace{-5mm}</p>
    <p><me>T = \frac{\ <c>r xbar_difference</c> - 0\ }{<c>r se_difference</c>} = <c>r t_difference</c></me></p>
    <p>We find the single tail area using software. We'll use the smaller of <m>n_n - 1 = <c>r n_nonsmoker-1</c></m> and <m>n_s - 1 = <c>r n_smoker-1</c></m> as the degrees of freedom: <m>df = <c>r df_difference</c>.</m> The one tail area is roughly 0.00017; doubling this value gives the two-tail area and p-value, 0.00034.</p>
    <p>The p-value is smaller than the discernibility level, 0.05, so we reject the null hypothesis. The data provide statistically discernible evidence of a difference in the average weights of babies born to mothers who smoked during pregnancy and those who did not.</p>
  </solution>
</example>



  <p>This result is likely not surprising. We all know that smoking is bad for you and you've probably also heard that smoking during pregnancy is not just bad for the mother but also for the baby as well. In fact, some in the tobacco industry actually had the audacity to tout that as a <em>benefit</em> of smoking:</p>


  <p>> <em>It's true. The babies born from women who smoke are smaller, but they're just as healthy as the babies born from women who do not smoke. And some women would prefer having smaller babies.</em> - Joseph Cullman, Philip Morris' Chairman of the Board on CBS' <em>Face the Nation</em>, Jan 3, 1971</p>


  <p>Furthermore, health differences between babies born to mothers who smoke and those who do not are not limited to weight differences.<fn>20-inference-two-means-6</fn></p>


  <p>A small note on the power of the independent t-test (recall the discussion of power in <xref ref="sec-pow"/>). It turns out that the independent t-test given here is often less powerful than the paired t-test discussed in <xref ref="sec-mathpaired"/>. That said, depending on how the data are collected, we don't always have a mechanism for pairing the data and reducing the inherent variability across observations.</p>



</subsection>

</section>

<section>
  <title>Mathematical model for estimating the difference in means</title>


<subsection>
  <title>Observed data</title>


  <p>As with hypothesis testing, for the question of whether we can model the difference using a <m>t</m>-distribution, we'll need to check new conditions. Like the 2-proportion cases, we will require a more robust version of independence so we are confident the two groups are also independent. Secondly, we also check for normality in each group separately, which in practice is a check for outliers.</p>



  <p><idx><h>point estimate</h><h>difference in means</h></idx><idx><h>difference in means</h><h>point estimate</h></idx></p>


<assemblage>
  <p><alert>Using the</alert> <m>t</m><alert>-distribution for a difference in means.</alert></p>
  <p>The <m>t</m>-distribution can be used for inference when working with the standardized difference of two means if</p>
  <p>-   <em>Independence</em> (extended). The data are independent within and between the two groups, e.g., the data come from independent random samples or from a randomized experiment.</p>
  <p>-   <em>Normality</em>. We check the outliers for each group separately.</p>
  <p>The standard error may be computed as <idx><h>standard error (SE)</h><h>difference in means</h></idx><idx><h>difference in means</h><h>standard error (SE)</h></idx></p>
  <p><me>SE = \sqrt{\frac{\sigma_1^2}{n_1} + \frac{\sigma_2^2}{n_2}}</me></p>
  <p>The official formula for the degrees of freedom is quite complex and is generally computed using software, so instead you may use the smaller of <m>n_1 - 1</m> and <m>n_2 - 1</m> for the degrees of freedom if software isn't readily available.</p>
</assemblage>


  <p>Recall that the margin of error is defined by the standard error. The margin of error for <m>\bar{x}_1 - \bar{x}_2</m> can be directly obtained from <m>SE(\bar{x}_1 - \bar{x}_2).</m></p>


<assemblage>
  <p><alert>Margin of error for</alert> <m>\bar{x}_1 - \bar{x}_2.</m></p>
  <p>The margin of error is <m>t^\star_{df} \times \sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}</m> where <m>t^\star_{df}</m> is calculated from a specified percentile on the t-distribution with <em>df</em> degrees of freedom.</p>
</assemblage>



</subsection>

<subsection>
  <title>Variability of the statistic</title>


  <p><idx><h>t-CI</h><h>difference in means</h></idx></p>


<example>
  <statement>
    <p>Can the <m>t</m>-distribution be used to make inference using the point estimate, <m>\bar{x}_{esc} - \bar{x}_{control} = 7.83</m>?</p>
  </statement>
  <solution>
    <p>First, we check for independence. Because the sheep were randomized into the groups, independence within and between groups is satisfied.</p>
    <p><xref ref="fig-stem-cell-histograms"/> does not reveal any clear outliers in either group. (The ESC group does look a bit more variable, but this is not the same as having clear outliers.)</p>
    <p>With both conditions met, we can use the <m>t</m>-distribution to model the difference of sample means.</p>
  </solution>
</example>


<listing xml:id="code-stem-cell-histograms">
  <caption>| Histograms for the difference in heart pumping function after a heart attack for both the treatment group (ESC, which received the embryonic stem cell treatment) and the control group (which did not receive the treatment).</caption>
  <program language="r">
    <code>
stem_cell |&gt;
  ggplot(aes(x = change)) +
  geom_histogram(binwidth = 2.5) +
  facet_wrap(~trmt, ncol = 1) +
  scale_x_continuous(labels = label_percent(scale = 1, accuracy = 1), breaks = seq(-10, 15, 5)) +
  labs(
    x = "Change in heart pumping function",
    y = "Count"
  )
    </code>
  </program>
</listing>

<figure xml:id="fig-stem-cell-histograms">
  <caption>Histograms for the difference in heart pumping function after a heart attack for both the treatment group (ESC, which received the embryonic stem cell treatment) and the control group (which did not receive the treatment).</caption>
  <image source="images/fig-stem-cell-histograms-1.png" width="70%" />
</figure>


  <p>Generally, we use statistical software to find the appropriate degrees of freedom, or if software isn't available, we can use the smaller of <m>n_1 - 1</m> and <m>n_2 - 1</m> for the degrees of freedom, e.g., if using a <m>t</m>-table to find tail areas. For transparency in the Examples and Guided Practice, we'll use the latter approach for finding <m>df</m>; in the case of the ESC example, this means we'll use <m>df = 8.</m></p>


<example>
  <statement>
    <p>Calculate a 95% confidence interval for the effect of ESCs on the change in heart pumping capacity of sheep after they've suffered a heart attack.</p>
  </statement>
  <solution>
    <p>We will use the sample difference and the standard error that we computed earlier:</p>
    <md>
\begin{aligned}
\bar{x}_{esc} - \bar{x}_{control} \amp= 7.83 \\
SE \amp= \sqrt{\frac{5.17^2}{9} + \frac{2.76^2}{9}} = 1.95
\end{aligned}
    </md>
    <p>Using <m>df = 8,</m> we can identify the critical value of <m>t^{\star}_{8} = 2.31</m> for a 95% confidence interval. Finally, we can enter the values into the confidence interval formula:</p>
    <md>
\begin{aligned}
\text{point estimate} \ \amp\pm\ t^{\star} \times SE \\
7.83 \ \amp\pm\ 2.31\times 1.95 \\
(3.32 \ \amp, \ 12.34)
\end{aligned}
    </md>
    <p>We are 95% confident that the heart pumping function in sheep that received embryonic stem cells is between 3.32% and 12.34% higher than for sheep that did not receive the stem cell treatment.</p>
  </solution>
</example>



</subsection>

</section>

<section xml:id="sec-chp20-review">
  <title>Chapter review</title>


<subsection>
  <title>Summary</title>


  <p>In this chapter we extended the single mean inferential methods to questions of differences in means. You may have seen parallels from the chapters that extended a single proportion (<xref ref="ch16-inference-single-proportion"/>) to differences in proportions (<xref ref="ch17-inference-two-proportions"/>). When considering differences in sample means (indeed, when considering many quantitative statistics), we use the t-distribution to describe the sampling distribution of the T score (the standardized difference in sample means). Ideas of confidence level and type of error which might occur from a hypothesis test conclusion are similar to those seen in other chapters (see <xref ref="ch14-decision-errors"/>).</p>


</subsection>

<subsection>
  <title>Terms</title>


  <p>The terms introduced in this chapter are presented in <xref ref="tbl-terms-chp-20"/>. If you're not sure what some of these terms mean, we recommend you go back in the text and review their definitions. You should be able to easily spot them as <alert>bolded text</alert>.</p>

<table xml:id="tbl-terms-chp-20">
  <title>Terms introduced in this chapter.</title>
  <tabular>
    <row><cell>point estimate, difference in means, SE difference in means</cell></row>
    <row><cell> t-CI, point estimate, T score, t-test</cell></row>
  </tabular>
</table>

</subsection>

</section>

<section xml:id="sec-chp20-exercises">
  <title>Exercises</title>

  <p>Answers to odd-numbered exercises can be found in <xref ref="sec-exercise-solutions-20" />.</p>
<xi:include href="../exercises/_20-ex-inference-two-means.ptx"/>

</section>

</chapter>
